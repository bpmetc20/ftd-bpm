package org.activiti.designer.util;

import java.io.File;

import org.activiti.designer.eclipse.common.ActivitiPlugin;
import org.eclipse.core.resources.IFile;
import org.eclipse.core.resources.ResourcesPlugin;
import org.eclipse.core.runtime.IPath;
import org.eclipse.core.runtime.IStatus;
import org.eclipse.core.runtime.Path;
import org.eclipse.core.runtime.Status;
import org.eclipse.jface.dialogs.ErrorDialog;
import org.eclipse.swt.widgets.Display;
import org.eclipse.ui.IWorkbenchPage;
import org.eclipse.ui.PartInitException;
import org.eclipse.ui.PlatformUI;
import org.eclipse.ui.ide.IDE;

public class DiagramHandler {
	public static final String fullDiagramPath = "/Users/osip.lisitsa/Desktop/FtdSolution/runtime-EclipseApplication/FTDSolutionDesigner/target/";

	public static void openDiagramForBpmnFile(String diagramName) {
		String fullFileName = fullDiagramPath +  diagramName +  ".bpmn";
		File file  = new File(fullFileName);
		IPath location= Path.fromOSString(file.getAbsolutePath()); 
		IFile ifile = ResourcesPlugin.getWorkspace().getRoot().getFileForLocation(location);
		openDiagramForBpmnFile(ifile);
	 }
	
	public static void openDiagramForBpmnFile(IFile dataFile) {

	      if (dataFile.exists())
	      {
	        final IWorkbenchPage activePage
	          = PlatformUI.getWorkbench().getActiveWorkbenchWindow().getActivePage();

	        try {
	          IDE.openEditor(activePage, dataFile, ActivitiConstants.DIAGRAM_EDITOR_ID, true);
	        } catch (PartInitException exception) {
	          final IStatus status = new Status(IStatus.ERROR, ActivitiPlugin.getID()
	                                          , "Error while opening new editor.", exception);

	          ErrorDialog.openError(Display.getCurrent().getActiveShell()
	                              , "Error Opening Activiti Diagram", null, status);
	        }
	      }
	 }
}
